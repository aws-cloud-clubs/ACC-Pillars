<h2 align="center"> ğŸ’‡ ì´ë©”ì¼ ëŒ€ëŸ‰ ë°œì†¡ ì‹œìŠ¤í…œ ì„¤ê³„</h2>



### ğŸ”— **Requirements** <br>
- ë§¤ì¼ ìµœëŒ€ 500ê±´ì˜ ì´ë©”ì¼ ëŒ€ëŸ‰ ë°œì†¡ í•„ìš”
- ì´ë©”ì¼ë‹¹ í‰ê·  í¬ê¸°ëŠ” 100KB ì˜ˆìƒ
- ì´ë©”ì¼ ë°œì†¡ ì§€ì—° ì‹œê°„ì€ 5ë¶„ ì´ë‚´
- ë°œì†¡ ì‹¤íŒ¨ ì²˜ë¦¬: ì‹¤íŒ¨í•œ ì´ë©”ì¼ì— ëŒ€í•œ ìë™ ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ)
- êµ¬ë… ê´€ë¦¬: ì‚¬ìš©ìë³„ ì´ë©”ì¼ ìˆ˜ì‹  ì„¤ì • ë° êµ¬ë… í•´ì§€ ê¸°ëŠ¥
- ìŠ¤íŒ¸ ë°©ì§€: SESì˜ SPFë¥¼ í†µí•œ ë„ë©”ì¸ ì¸ì¦

### ğŸ”— **User Scenarios** <br>
- ë¬´ì‹ ì‚¬ ë§ˆì¼€íŒ… ì§ì› Aì”¨ê°€ ê³ ê° 200ëª…ì—ê²Œ ë§ì¶¤í˜• í™ë³´ ì´ë©”ì¼ ì „ì†¡



## ğŸ‘¥ Team members

<div align=center> 

  | ë°•ì–¸ì„  | ê¹€ì§€ì› | ë°•ê°€ì˜ | ì´ë™ì¤€ | ì •í˜„ì„ | í™©ê·œë¦¬|
  | :---: | :---: | :---: | :---: | :---: | :---: |  
  | <img src="https://avatars.githubusercontent.com/eonpark" alt="profile" width="180" height="180"> | <img src="https://avatars.githubusercontent.com/JiwonKim08" alt="profile"   width="180" height="180"> | <img src="https://avatars.githubusercontent.com/ParkIsComing" alt="profile" width="180" height="180"> | <img src="https://avatars.githubusercontent.com/dongjune8931" alt="profile" width="180" height="180">| <img src="https://avatars.githubusercontent.com/Junghs21" alt="profile" width="180" height="180"> | <img src="https://avatars.githubusercontent.com/gyuuuuri" alt="profile" width="180" height="180">|
  | [eonpark](https://github.com/eonpark) | [JiwonKim08](https://github.com/JiwonKim08) | [ParkIsComing](https://github.com/ParkIsComing) | [dongjune8931](https://github.com/dongjune8931)| [Junghs21](https://github.com/Junghs21)| [gyuuuuri](https://github.com/gyuuuuri)|

</div>

## âœ¨ Technology Stack

<div align=center> 
<img src="https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazonwebservices&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20EC2-FF9900?style=for-the-badge&logo=Amazon%20EC2&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20S3-569A31?style=for-the-badge&logo=Amazon%20S3&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20DynamoDB-4053D6?style=for-the-badge&logo=Amazon%20DynamoDB&logoColor=white">
<img src="https://img.shields.io/badge/AWS%20Step%20Functions-00B2E5?style=for-the-badge&logo=aws-stepfunctions&logoColor=white">
<img src="https://img.shields.io/badge/AWS%20Lambda-4F5D95?style=for-the-badge&logo=aws-lambda&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20SQS-4B9CDB?style=for-the-badge&logo=Amazon%20SQS&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20CloudWatch-2575E0?style=for-the-badge&logo=Amazon%20CloudWatch&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20SES-FF9900?style=for-the-badge&logo=Amazon%20SES&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20API%20Gateway-003A6C?style=for-the-badge&logo=Amazon%20API%20Gateway&logoColor=white">
<img src="https://img.shields.io/badge/Amazon%20RDS-527FFF?style=for-the-badge&logo=Amazon%20RDS&logoColor=white">
  <br>
</div>


## â” **AWS Services Usage Explanations** 
> **Lambda**
  - 15ë¶„ì˜ Lambda ì‹¤í–‰ ì‹œê°„ì˜ ì œì•½ ë°œìƒ
  - but, Serverless í™˜ê²½ì˜ ì¥ì ì„ ì‚¬ìš©í•˜ê³  ì‹¶ìŒ
  - StepFunction ë„ì…
> **StepFunction**
  
  - Mapì„ ì‚¬ìš©í•´ ë™ì¼í•œ ì›Œí¬í”Œë¡œìš°(ì˜ˆ: Lambda í•¨ìˆ˜ í˜¸ì¶œ)ë¥¼ ë³‘ë ¬ë¡œ ì‹¤í–‰
  - ì „ì²´ ì‹¤í–‰ì‹œê°„ì„ ë‹¨ì¶• & ë³µì¡í•œ ë°˜ë³µ ë¡œì§ì„ ê°„ê²°í•˜ê²Œ ì²˜ë¦¬ 
  - ì´ë©”ì¼ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì²˜ë¦¬ì†ë„ ìƒìŠ¹
> **Email Verification(sandbox)**
-
> **DynamoDB**




## **ğŸ›  Overall Project Structure Diagram**
<img width="914" alt="AWS êµ¬ì¡°ë„" src="https://github.com/user-attachments/assets/f7638310-3dc0-4970-a5f5-7b0f71334790">

## **ğŸ›  StepFunction Map Flow**
<img width="349" alt="stepfunction flow" src="https://github.com/user-attachments/assets/af3c839c-602f-4aac-a89b-3990a0e5c0cc">

## ğŸ¯ **Lambda Explanations**
> **StepFunction ë‚´ Lambda ë³„ ê¸°ëŠ¥ ë° Input/Output**

|   | Lambda(1) | Lambda(2) | Lambda(3) |
|---|-----------|-----------|-----------|
| **ëª©ì ** | ìœ ì €ë¦¬ìŠ¤íŠ¸ nê°œì”© ê°€ì ¸ì˜´ | payloadë¥¼ íë¡œ nê°œì”© ì „ì†¡ | SQSì—ì„œ SESë¡œ ì´ë©”ì¼ ì „ì†¡ |
| **Input** | ìœ ì €ë¦¬ìŠ¤íŠ¸ chunk (í¬ê¸°: nê°œ) (DynamoDBì—ì„œ ìœ ì € ë°ì´í„° ëª‡ ê°œ ì½ì–´ì˜¬ ì§€) | ìœ ì €ë¦¬ìŠ¤íŠ¸ ë°ì´í„° (DynamoDBì—ì„œ êº¼ë‚´ì˜¨ ì •ë³´) | ìœ ì € payload ë¦¬ìŠ¤íŠ¸ nê°œ ë°°ì¹˜ |
| **Output** | 1. ìœ ì €ë¦¬ìŠ¤íŠ¸ chunk (DynamoDBì—ì„œ êº¼ë‚´ì˜¨ ì •ë³´ = name, email, gender, isscribing) 2. í…œí”Œë¦¿ ì •ë³´ | ìœ ì € payload ë¦¬ìŠ¤íŠ¸ nê°œ ë°°ì¹˜ (name, email, subject, body) | ë©”ì¼ ì™„ì„±ë³¸ (í…œí”Œë¦¿ì— ìœ ì € payload ì‚½ì… + êµ¬ë…ì·¨ì†Œë§í¬ ì‚½ì… + S3ì—ì„œ ê°€ì ¸ì˜¨ ì´ë¯¸ì§€ ì‚½ì…) |



-Lambda (1) - GetUserData
  -
  <strong>Output</strong>
  ```
{
  "result": {
    "Payload": [
      {
        "Gender": "Male",
        "SubscriptionStatus": true,
        "Email": "jiwonkim0810@gmail.com",
	      "Name": "chulsu"
      },
      
        .
        .      (ìƒëµ)
        .
      
      
      {
        "Gender": "Female",
        "SubscriptionStatus": "true",
        "Email": "yuripark066@gmail.com",
        "Name": "Karen Young"
      },
    ],
    "LastEvaluatedKey": {
      "Email": "yuripark066@gmail.com"
    } 
  }
  ```
  ```
- 10ê°œì˜ ìœ ì €ë°ì´í„° outputì€ map#1~map#10ì— í•´ë‹¹
- ë“¤ê³  ì˜¨ ë§ˆì§€ë§‰ ë°ì´í„°ë¥¼ LastEvaluatedKey ë¡œ ì €ì¥
  ```

-Lambda (2) - EmailQueuer
  -
<table>
  <tr>
    <td><strong>Input</strong></td>
    <td><strong>Output</strong></td>
  </tr>
  <tr>
    <td>
      <pre>
{
  "Gender": "Female",
  "SubscriptionStatus": "true",
  "Email": "jiwonkim0810@gmail.com",
  "Name": "chulsu"
}
      </pre></br></br></br></br></br></br></br></br><blockquote>
    </td>
    <td>
      <pre>
{
  "statusCode": 200, "body": { "template": { "subject": "í™˜ì˜í•©ë‹ˆë‹¤!", "body": "<!DOCTYPE html><html lang=\"ko\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>{{Subject}}</title></head><body><p>ì•ˆë…•í•˜ì„¸ìš”, {{Name}}ë‹˜!</p><p>{{Body}}</p><p><a href=\"https://www.musinsa.com\">ì§€ê¸ˆ ì‡¼í•‘í•˜ê¸°</a></p><p>ê°ì‚¬í•©ë‹ˆë‹¤,<br>ë¬´ì‹ ì‚¬ íŒ€</p><p>ì´ ë©”ì¼ì€ ë¬´ì‹ ì‚¬ì—ì„œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ìˆ˜ì‹  ê±°ë¶€ë¥¼ ì›í•˜ì‹œë©´ <a href=\"#\">ì—¬ê¸°</a>ë¥¼ í´ë¦­í•˜ì„¸ìš”.</p></body></html>" }, 
  "user": {
     "Email": "jiwonkim0810@gmail.com",
      "Name": "chulsu",
      "Subject": "ë¬´ì‹ ì‚¬ íŒŒê²©ì„¸ì¼", 
      "Body": "ë“¤ì–´ê°€ëŠ” ë§" } }
}
      </pre>
    </td>
  </tr>
</table>

```
- Lambda(2)ì˜ ìœ„ í¬ë©§ì€ map#1ë§Œì„ ì˜ë¯¸ 
- Step Functionsì˜ Map íŠ¹ì„±ìƒ, ë‚˜ë¨¸ì§€ map#2~map#10ë„ ë³‘ë ¬ ì²˜ë¦¬ë˜ê³  ìˆìŒ
    â†’ SESì— ì €ì¥í•´ ë‘” í…œí”Œë¦¿ì„ ê°€ì ¸ì™€ Lambda(3)ë¡œ ì˜®ê¹€
    â†’ Lambda(3)ë¡œ ì´ë™ ì „ SQS ê±°ì¹¨
  ```



-Lambda (3) - EmailPayload
  -
  ```
  - ë©”ì¼ ì™„ì„±ë³¸ì„ SESë¡œ ì „ë‹¬
     -> S3ìœ¼ë¡œë¶€í„° ì´ë¯¸ì§€ ì‚½ì…
     -> êµ¬ë… ì·¨ì†Œ ë§í¬ ì‚½ì…
  ```

- StepFunction
    -
    ```python
    {
      "StartAt": "Lambda (1)",
      "States": {
        "Lambda (1)": {
          "Type": "Task",
          "Resource": "arn:aws:lambda:ap-northeast-2:008971651769:function:GetUserData10",
          "ResultPath": "$.result",
          "Next": "Map"
        },
        "Map": {
          "Type": "Map",
          "ItemsPath": "$.result.Payload",
          "MaxConcurrency": 10,
          "ItemProcessor": {
            "ProcessorConfig": {
              "Mode": "INLINE"
            },
            "StartAt": "Lambda(2)",
            "States": {
              "Lambda(2)": {
                "Type": "Task",
                "Resource": "arn:aws:lambda:ap-northeast-2:008971651769:function:EmailQueuer_update",
                "Next": "Lambda (3)"
              },
              "Lambda (3)": {
                "Type": "Task",
                "Resource": "arn:aws:states:::lambda:invoke",
                "OutputPath": "$.Payload",
                "Parameters": {
                  "Payload.$": "$",
                  "FunctionName": "arn:aws:lambda:ap-northeast-2:008971651769:function:email_pra"
                },
                "Retry": [
                  {
                    "ErrorEquals": [
                      "Lambda.ServiceException",
                      "Lambda.AWSLambdaException",
                      "Lambda.SdkClientException",
                      "Lambda.TooManyRequestsException"
                    ],
                    "IntervalSeconds": 1,
                    "MaxAttempts": 3,
                    "BackoffRate": 2
                  }
                ],
                "End": true
              }
            }
          },
          "Next": "CheckForMoreData",
          "ResultPath": "$.results_test"
        },
        "CheckForMoreData": {
          "Type": "Choice",
          "Choices": [
            {
              "Variable": "$.result.LastEvaluatedKey",
              "IsPresent": true,
              "Next": "UpdateLastEvaluatedKey"
            }
          ],
          "Default": "Finish"
        },
        "UpdateLastEvaluatedKey": {
          "Type": "Pass",
          "Parameters": {
            "LastEvaluatedKey.$": "$.result.LastEvaluatedKey"
          },
          "ResultPath": "$.meta",
          "Next": "Lambda (1)"
        },
        "Finish": {
          "Type": "Succeed"
        }
      }
    }   
     ```

## ğŸ›  DynamoDB ì„¤ê³„
### [User Table]
- ìœ ì € ì •ë³´ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í…Œì´ë¸”

**Partition key**
- Email(String)
    - ìœ ì € ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©

**Attributes**
- Name(String)
    - ìœ ì € ì´ë¦„ì„ ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- Gender(String)
    - í•´ë‹¹ ìœ ì €ì˜ ì„±ë³„ì„ ì €ì¥
- CreateTime(ìˆ«ì)
    - íšŒì›ê°€ì… ì‹œê°„ ì €ì¥
- SubscriptionStatus(ë¶€ìš¸)
    - êµ¬ë… ìƒíƒœë¥¼ ì €ì¥

### [ImageAndTemplate Table]
- ì´ë©”ì¼ í…œí”Œë¦¿ê³¼ ì‚¬ìš©í•˜ëŠ” ì´ë¯¸ì§€ë“¤ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ í…Œì´ë¸”

**Partition key**
- TemplateID(String)
    - ì´ë©”ì¼ í…œí”Œë¦¿ì„ ê³ ìœ í•˜ê²Œ ì‹ë³„í•  TemplateID

**Attributes**
- ImageURLs(List)
    - í•´ë‹¹ í…œí”Œë¦¿ì´ë‘ ë§¤í•‘í›„, s3ì— ì €ì¥ëœ í•´ë‹¹ ì´ë¯¸ì§€ ì£¼ì†Œ
- TemplateName(String)
    - ì´ë©”ì¼ í…œí”Œë¦¿ ì‚¬ìš© ìš©ë„ë¥¼ ê°„ëµí•˜ê²Œ ì €ì¥í•˜ê¸° ìœ„í•œ ìš©ë„






## ğŸ”— ê¸°ìˆ  ë¸”ë¡œê·¸ ë§í¬



## ğŸ”— ìµœì¢… ë³´ê³ ì„œ ë§í¬







